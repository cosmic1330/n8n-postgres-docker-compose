# 1. 允許本地 Unix Socket 連線 (如 docker exec)
local   all             all                                     trust

# 2. 限制 root (Superuser) 僅能從容器內部 (127.0.0.1) 連線
host    all             root            127.0.0.1/32            trust
host    all             root            ::1/128                 trust
host    all             root            0.0.0.0/0               reject

# 3. 限制 n8n_user 只能從內網連線到 n8n 資料庫
host    n8n             n8n_user        172.25.0.0/16           scram-sha-256

# 4. 允許 app_reader 從任何地方透過 SSL 連線到 app 資料庫 (Replica 僅供讀取)
# 注意：這會曝露在網際網路上，必須強制 SSL
hostssl app             app_reader      0.0.0.0/0               scram-sha-256

# 5. 允許資料庫同步 (Replication)
host    replication     replicator      172.25.0.0/16           scram-sha-256

# 6. 預設獲拒絕其他所有連線
host    all             all             0.0.0.0/0               reject
